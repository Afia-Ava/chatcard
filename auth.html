<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In / Sign Up | ChatCard</title>
    <link rel="stylesheet" href="login.css" />
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>
  </head>
  <body style="min-height: 100vh; display: flex; flex-direction: column">
    <div id="grain"></div>
    <nav class="top-navbar pill-navbar">
      <div class="pill-navbar-inner">
        <div class="pill-navbar-logo">
          <a href="index.html" class="logo-text">chatcard</a>
        </div>
        <div class="pill-navbar-links">
          <a href="about.html" class="nav-link">About</a>
          <a href="privacy.html" class="nav-link">Privacy</a>
          <a href="community.html" class="nav-link">Community</a>
          <a href="contact.html" class="nav-link">Contact</a>
        </div>
        <div class="pill-navbar-actions">
          <div class="login-button-container" id="profileContainer">
            <a href="login.html" class="login-btn" id="loginBtn">Log In</a>
          </div>
        </div>
      </div>
    </nav>
    <main
      style="
        max-width: 400px;
        margin: 48px auto 0 auto;
        padding: 32px 24px;
        background: rgba(30, 30, 30, 0.7);
        border-radius: 18px;
        box-shadow: 0 4px 32px rgba(0, 0, 0, 0.12);
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
      "
    >
      <h1
        style="
          font-size: 2rem;
          font-weight: 600;
          margin-bottom: 24px;
          text-align: center;
        "
      >
        Sign In / Sign Up
      </h1>
      <form
        id="authForm"
        style="width: 100%; display: flex; flex-direction: column; gap: 18px"
      >
        <input
          type="email"
          id="email"
          placeholder="Email"
          required
          style="padding: 12px; border-radius: 8px; border: 1px solid #ccc"
        />
        <input
          type="password"
          id="password"
          placeholder="Password"
          required
          style="padding: 12px; border-radius: 8px; border: 1px solid #ccc"
        />
        <button
          type="button"
          onclick="signIn()"
          style="
            background: #222;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1em;
          "
        >
          Sign In
        </button>
        <button
          type="button"
          onclick="signUp()"
          style="
            background: #eee;
            color: #222;
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-size: 1em;
          "
        >
          Sign Up
        </button>
      </form>
      <div
        id="authMessage"
        style="margin-top: 16px; color: #e4e4e7; text-align: center"
      ></div>
    </main>
    <footer class="footer-note" style="margin-top: 48px; margin-bottom: 0">
      Â© 2025 ChatCard. All rights reserved.
    </footer>
    <script>
      // Firebase v8 API
      let app, auth;
      document.addEventListener('DOMContentLoaded', function () {
        if (typeof firebase !== 'undefined') {
          if (!firebase.apps.length) {
            app = firebase.initializeApp(firebaseConfig);
          } else {
            app = firebase.app();
          }
          auth = firebase.auth();
          // Listen for auth state changes and update navbar
          auth.onAuthStateChanged(function (user) {
            updateNavbar(user);
          });
        }
      });
      function signIn() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password)
          return showMessage('Please enter email and password.');
        auth
          .signInWithEmailAndPassword(email, password)
          .then(function (userCredential) {
            showMessage('Signed in successfully!');
            updateNavbar(userCredential.user);
          })
          .catch(function (err) {
            showMessage(err.message);
          });
      }
      function signUp() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if (!email || !password)
          return showMessage('Please enter email and password.');
        auth
          .createUserWithEmailAndPassword(email, password)
          .then(function (userCredential) {
            showMessage('Account created! You are signed in.');
            updateNavbar(userCredential.user);
          })
          .catch(function (err) {
            showMessage(err.message);
          });
      }
      function showMessage(msg) {
        document.getElementById('authMessage').textContent = msg;
      }
      function updateNavbar(user) {
        const container = document.getElementById('profileContainer');
        if (!container) return;
        if (user) {
          // Remove login button and show profile icon + username
          const name = user.displayName || user.email;
          container.innerHTML = `<span style="display:inline-flex;align-items:center;gap:8px;"><img src='https://ui-avatars.com/api/?name=${encodeURIComponent(
            name
          )}&background=222&color=fff&size=32' alt='Profile' style='width:32px;height:32px;border-radius:50%;border:2px solid #eee;vertical-align:middle;'> <span style='color:#fff;font-weight:500;'>${name}</span></span>`;
        } else {
          container.innerHTML = `<a href="login.html" class="login-btn" id="loginBtn">Log In</a>`;
        }
      }
    </script>
  </body>
</html>
